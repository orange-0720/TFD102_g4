<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>良耕野菜-會員中心</title>
    <link rel="stylesheet" href="./css/style.css" />
    <link rel="icon" href="./images/logo-02.svg">
    <script src="./js/jquery-3.6.0.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script>
      function Logout(){
        $.ajax({
          method:'POST',
          url:'php/Logout.php',
          dataType: 'json',
          data:{},
          success : function(response) {
            console.log(response);
            if(response == 1) {
              alert('已為您登出，並跳轉首頁');
              window.location.href = './index.html';
            }
          },
          error: function(exception) {
              console.log(exception);
              alert("發生錯誤: " + exception.status);
          },
        })
      };

      function getActive(){
        $ajax({
          method:'POST',
          url:'php/getActive.php',
          dataType: 'json',
          success: function(response){
            console.log(response);
          },
          error: function(exception) {
              alert("發生錯誤: " + exception.status);
          },
        })
      };
    </script>
  </head>
  <body>
    <header class="header">
      <!-- 手機板header -->
      <div class="fixed_top">
        <div class="fixed_top_logo">
          <a href="./index.html">
            <img src="./images/fixed_top_logo.svg" alt="top_logo">
          </a>
        </div>
        <div class="shop_car">
          <img src="./images/shopping_cart.svg" alt="shopping_cart" />
        </div>
        <div class="ham">
          <div class="ham_top"></div>
          <div class="ham_middle"></div>
          <div class="ham_bottom"></div>
        </div>
      </div>
      <!-- 手機板header結束 -->
      <div class="menu_fixed">
        <div class="icon">
          <div class="ham">
            <div class="ham_top"></div>
            <div class="ham_middle"></div>
            <div class="ham_bottom"></div>
          </div>
          <div class="login">
            <a href="./login.html">
              <img src="./images/login_icon.svg" alt="login_icon" />
            </a>
          </div>
          <div class="shop_car">
            <img src="./images/shopping_cart.svg" alt="shopping_cart" />
          </div>
        </div>
      </div>
      <div class="menu">
        <div class="logo_img">
          <a href="./index.html">
            <img src="./images/logo.svg" alt="logo" />
          </a>
        </div>
        <div class="page_list">
          <a href="./event.html">農村體驗</a>
          <a href="./fruit_box.html">客製蔬果箱</a>
          <a href="./game.html">蔬果知識小遊戲</a>
          <a href="./aboutUs.html">關於我們</a>
          <a href="./q_a.html">問與答</a>
          <a href="./shopping_page.html">新鮮蔬果</a>
        </div>
      </div>
      <div class="title">
        <div class="title_btn">
          <button class="comm_us">
            聯絡我們 <img src="./images/cotact_us.svg" width="25px" alt="" />
          </button>
          <a class="buy_now" href="./shopping_page.html">
            立即買<img src="./images/buy_now.svg" width="25px" alt="" />
          </a>
        </div>
        <div class="title_pic">
          <img
            src="./images/member/member_01.jpg"
            alt="checkout_pic"
            style="padding-bottom: 100px;"
          />
          <span class="bkc_black"></span>
          <h1>會員中心</h1>
        </div>
      </div>

      <!-- 漢堡彈窗 -->
      <div class="jump_hamburger_block">
        <div class="hamburger_logo">
          <a href="./index.html">
            <img src="./images/logo.svg" alt="logo">
          </a>
        </div>
        <div class="header_nav_block">
          <div class="nav_block_contact">
            <img src="./images/nav_block_pen.svg" >
            聯絡我們
          </div>
          <a class="nav_block_log" href="./login.html">
            <img src="./images/nav_block_log.svg">
            登入註冊
          </a>          
          <div class="nav_right_block">
            <div class="nav_active">
              <a href="./event.html">農村體驗</a>
              <a href="./event_info.html">預約去</a>
            </div>
            <div class="nav_buy_now">
              <a href="./shopping_page.html">立即買</a>
              <a href="./fruit_box.html">客製蔬果箱</a>
              <a href="./shopping_page.html">新鮮蔬果</a>
            </div>
            <div class="nav_knowledge">
              <a href="./game.html">蔬果知識小遊戲</a>
            </div>
          </div>
          <div class="nav_left_block">
            <div class="nav_about_us">
              <a href="./aboutUs.html">關於我們</a>
              <a href="./aboutUs.html">農場介紹</a>
              <a href="./product_introduction.html">生產介紹</a>
            </div>
            <div class="nav_QA">
              <a href="./q_a.html">問與答</a>
            </div>
          </div>
          <img src="./images/header_vegetable.svg" alt="vegetable" class="header_vegetable">
          <img src="./images/header_lemon.svg" alt="vegetable" class="header_lemon">
          <img src="./images/header_kiwi.svg" alt="vegetable" class="header_kiwi">
        </div>
      </div>
      <!-- 漢堡彈窗結束 -->
      
      <div class="index_contact_box">
        <div class="black_block"></div>
        <div class="cotanct_block">
            <div class="contact_block_head">
              <button class="contact_block_Xmark"></button>
            </div>
            <h2>聯絡我們</h2>
            <div class="contact_search_bar">
              <input type="text" id="order_search" placeholder="請輸入訂單編號">
              <button class="search_icon">
                <img src="./images/header_search_icon.svg" alt="search">
              </button>
            </div>
            <h3>若有其他問題可以點擊下方按鈕寄信</h3>
            <div class="mailto_block">
              <a class="contact_mailto" href="mailto:goodvegetablebox@gmail.com">寄送問題</a>
            </div>
        </div>
      </div>

      <!-- 購物車彈窗  -->
      <div class="header_shopping_cart">
        <button class="cart_close">
          <img src="./images/checkout/X_mark.svg">
        </button>
        <div class="incart_car_block">
          <img src="./images/header_incart.svg" alt="">
        </div>
        <div class="cart_buy_list">
          目前購物車空無一物
        </div>
        <div class="incart_total">
          總和
          <span>$0</span>
        </div>
        <div class="incart_checkout_block">
          <a class="incart_checkout_btn" href="./checkout.html">結帳去</a>
        </div>
      </div>
      <!-- 購物車彈窗結束  -->
    </header>

    <!-- 本頁內容 -->

    <div class="member_logout_block">
        <button onclick="Logout()">登出<img src="./images/member/logout_icon.svg" alt=""></button>
        <h3>持有購物金:<span>0</span>元</h3>
    </div>

    <!-- vue範圍開始 -->
    <div class="member_block" id="member_block">
        <div class="member_block_nav">
            <div @click="show_member" class="member_detail">會員資料</div>
            <div @click="show_order" class="member_order">訂單查詢</div>
            <div @click="show_active" class="member_active">活動查詢</div>
            <div @click="show_message" class="member_message">留言板</div>
        </div>
        <div class="member_right_member" v-if="memberShow">
          <h3>會員資料</h3>
          <div class="member_right_detail">
            <div class="member_pic_block">
              <img src="./images/member/member_fake_img.svg" alt="大頭照">
              <button class="member_pwd_change" @click="show_up">
                <img src="./images/member/member_pen.svg" alt="pen">變更密碼
              </button>
            </div>
            <!-- 會員資料印出 -->
            <div class="member_detail_info">
              <div class="member_info_name">
                姓名:
                <input type="text" :disabled="onChange" v-model="member_name">
              </div>
              <div class="member_info_hb">
                生日:
                <input type="text" placeholder="1992/05/27" :disabled="onChange" v-model="member_hb">
              </div>
              <div class="member_info_phone">
                手機:
                <input type="text" :disabled="onChange" v-model="member_phone">
              </div>
              <div class="member_info_address">
                地址:
                <input type="text" :disabled="onChange" v-model="member_address">
              </div>
            </div> 
          </div>
          <button class="member_change_detail" @click="changeWord">
            <img src="./images/member/member_pen.svg" alt="筆">
            <span>編輯會員資料</span>
          </button>
        </div>
        <!-- 變更密碼彈窗 -->
        <div class="change_pwd_box" >
          <div class="pwd_black_block" @click="show_up"></div>
          <div class="change_pwd_block">
              <div class="pwd_block_head">
                <button class="pwd_block_Xmark" @click="show_up"></button>
              </div>
              <h2>變更密碼</h2>
              <div class="change_box">
                <input type="text" id="old_pwd1" placeholder="請輸入原本密碼">
                <input type="text" id="old_pwd2" placeholder="請再次輸入">
                <input type="text" id="new_pwd" placeholder="請輸入新密碼">
              </div>
              <input type="button" class="change_send" value="確認變更" @click="change_pwd">
          </div>
        </div>

        <!-- 訂單開始 -->
        <div class="member_order_detail" v-if="orderShow">
            <h3>訂單查詢</h3>
            <div class="member_order_block">
              <div class="order_box">
                <div class="order_line">
                  <h4>下單時間</h4>
                  <h4>訂單編號</h4>
                  <h4>付款方式</h4>
                  <h4>訂單金額</h4>
                  <h4>配送狀態</h4>
                </div>
                <div class="order_inside_detail">
                  <h4>2021/09/01</h4>
                  <h4>A0001</h4>
                  <h4>信用卡</h4>
                  <h4>399</h4>
                  <h4>配送中</h4>
                </div>
              </div>
              <hr>
              <div @click="turn_on" class="show_order_detail">
                訂單內容
                <img class="member_arrow_icon" src="./images/member/member_arrow_icon.svg" alt="">
                <div class="member_check_order_detail">
                  <div class="check_order_box">
                    <div class="show_order_detail_block">
                      <section class="show_order_detail_img">商品圖片</section>
                      <section class="show_order_detail_name">商品名稱</section>
                      <section class="show_order_detail_sum">數量</section>
                      <section class="show_order_detail_price">單價</section>
                      <section class="show_order_detail_total">小計</section>
                    </div>

                    <!-- 訂單內容迴圈出現 -->
                    <div class="show_order_product_detail">
                      <section class="show_order_product_detail_img">
                        <img src="./images/checkout/checkout_01.jpg">
                      </section>
                      <section class="show_order_product_detail_name">防疫蔬果箱</section>
                      <section class="show_order_product_detail_sum">
                        1
                      </section>
                      <section class="show_order_product_detail_price">399</section>
                      <section class="show_order_product_detail_total">399</section>
                    </div>
                  </div>
                  <hr>
                  <p class="show_order_total_price">總金額:<span>399</span></p>
                </div>
              </div>
            </div>
          </div>

          <div class="member_active_detail" v-if="activeShow">
            <h3>活動查詢</h3>
            <div class="member_active_block">
              <div class="active_box">
                <div class="active_line">
                  <h4 v-for="item in active_line">{{item}}</h4>
                </div>

                <!-- 撈出資料庫資料並秀出 使用v-for製造多個訂單資訊 -->
                <div class="active_inside_detail" v-for="item in actives">
                  <h4>{{item.ACTIVITY_ID}}</h4>
                  <h4>{{item.APPOINTMENT_ID}}</h4>
                  <h4>{{item.START_DATE}}</h4>
                  <h4>399</h4>
                  <h4>{{item.PEOPLE_NUM}}</h4>
                </div>
              </div>
            </div>
          </div>

          <div class="member_message_detail" v-if="messageShow">
            <h3>留言板</h3>
            <div class="member_message_block">
              <div class="message_line">良耕野菜</div>
              <div class="message_inside_detail">
                <h3 class="no_message">目前尚未收到您的任何訊息</h3>
                <textarea class="your_question" rows="5" placeholder="請寫下您的疑問" v-model="your_question"></textarea>
                <div class="member_message_button">
                  <input type="file" id="message_img">
                  <label for="message_img">加入圖片</label>
                  <input type="button" value="傳送" id="message_submit" @click ='send_message'>
                </div>
              </div>
            </div>
          </div>  
    </div>
    <footer class="footer_bg">
      <img class="member_footer_img" src="./images/member/member_footer.svg" alt="for_footer">
      <div class="footer">
        <button class="go_top" id="go_top">
          <img src="./images/top.svg" alt="top">
        </button>
        <div class="footer_logo">
          <a href="./index.html">
            <img src="./images/logo.svg" alt="logo" />
          </a>
        </div>
        <div class="footer_center">
          <h4>電話:02-26938800</h4>
          <h5>營業時間: 星期二至星期日(10:00 - 17:00)</h5>
          <h5>※農曆過年假期本農場也公休
            網路接單為24小時</h5>
          <h5>※當日訂單最晚收到17:00</h5>
          <h5>(17:00後下單視為隔日下單)</h5>
          <div class="btn_pos">
            <button class="mail_btn">
              <img src="./images/mail.svg" alt="mail">MAIL
            </button>
          </div>
          <div class="footer_icon">
            <img src="./images/icon-fb.svg" alt="fb">
            <img src="./images/icon-line.svg" alt="line">
            <img src="./images/icon-ig.svg" alt="ig">
          </div>
        </div>
        <div class="footer_right">
          <div class="right_main">
            <a href="./index.html">首頁</a>
            <a href="./event.html">農村體驗</a>
            <a href="./game.html">蔬果知識小遊戲</a>
            <a href="./aboutUs.html">關於我們</a>
            <a href="./q_a.html">問與答</a>
          </div>
          <div class="right_buy">
            <a href="./fruit_box.html">客製蔬果箱</a>
            <a href="./shopping_page.html">蔬菜</a>
            <a href="./shopping_page.html">水果</a>
          </div>
        </div>
      </div>
    </footer>
    
    <script src="./js/header.js"></script>
    <script>
      // 回頁首
      $("#go_top").on("click", function (e) {
      e.preventDefault();
      $('html, body').animate({
          scrollTop: 0
        }, 750);
      });
      

      var member_block = new Vue({
        el:"#member_block",
        data:{
          member_name:"",
          member_hb:"",
          member_phone:"",
          member_address:"",

          active_line:[
            '預約編號',
            '活動內容',
            '預約日期',
            '金額',
            '人數'
          ],

          onChange:true,

          isActive: false,
          memberShow:true,
          orderShow:false,
          activeShow:false,
          messageShow:false,

          your_question: "",

          actives:[],

        },
        methods: {
          turn_on(){
            let arrow = document.getElementsByClassName('member_arrow_icon')[0];
            arrow.classList.toggle('turn_on');
            $('.member_check_order_detail').slideToggle();
          },
          show_member(){
            this.memberShow = true;
            this.orderShow = false;
            this.activeShow = false;
            this.messageShow = false;
          },
          show_order(){
            this.orderShow = true;
            this.memberShow = false;
            this.activeShow = false
            this.messageShow = false;
          },
          show_active(){
            this.orderShow = false;
            this.memberShow = false;
            this.activeShow = true;
            this.messageShow = false;
          },
          show_message(){
            this.orderShow = false;
            this.memberShow = false;
            this.activeShow = false;
            this.messageShow = true;
          },
          changeWord() {
            this.onChange = !this.onChange;
            if(this.onChange == false){
              $('.member_change_detail > span').text('儲存變更');
              $('.member_detail_info input').css('background-color', '#FFF')
            }else{
              $('.member_change_detail > span').text('編輯會員資料');
              $('.member_detail_info input').css('background-color', '#FFF7D2');
              this.change_detail();
            }
          },
          show_up(){
            $('.change_pwd_box').fadeToggle();
            console.log('aaa')
          },
          send_message(){
            let val = $('.your_question').val();
            $('.no_message').fadeOut();
            $('.message_inside_detail').prepend(
              `<div class="customer_message">
                    <div class="customer_message_left">
                      <span>會員</span>
                    </div>
                    <div class="customer_message_right">
                      ${this.your_question}    
                    </div>       
                </div>
            `);
            this.your_question = "";
          },
          change_detail(){
            $.ajax({
              method:'POST',
              url:'php/change_detail.php',
              data:{
                name: this.member_name,
                hb: this.member_hb,
                phone: this.member_phone,
                address: this.member_address,
              },
              dataType: 'json',
              success: function(response){
                if(response == 1){
                  alert('會員資料更新完成');
                }
              },
              error: function(exception) {
                  alert("發生錯誤: " + exception.status);
                  console.log(exception)
              },
            })
          },
          change_pwd(){
            if($('#old_pwd1').val() == $('#old_pwd2').val()){
              $.ajax({
                method:'POST',
                url:'php/change_pwd.php',
                data:{
                  old_pwd: $('#old_pwd1').val(),
                  new_pwd: $('#new_pwd').val(),
                },
                dataType: 'json',
                success: function(response){
                  if(response == 1){
                    alert('密碼變更完成');
                  }else{
                    alert('密碼錯誤');
                  }
                },
                error: function(exception) {
                    alert("發生錯誤: " + exception.status);
                    console.log(exception)
                },
              })
            }else{
              alert('請確認兩次密碼是否相同')
            }
          }
        },
        
        mounted() {
          // 串接活動
          $.ajax({
            method: 'POST',
            url: 'php/getActive.php',
            data:{},
            dataType: 'json',
            success: function(response) {
              member_block.actives = response;
              console.log(response);
            },
            error: function(exception) {
                alert("發生錯誤: " + exception.status);
            },
          }),
          $.ajax({
            method: 'POST',
            url: 'php/getMember.php',
            data:{},
            dataType: 'json',
            success: function(response) {
              console.log(response);
              response.forEach(function(index,i){
                member_block.member_name = index['NAME'];
                member_block.member_hb = index['PHONE'];
                member_block.member_phone = index['PHONE'];
                member_block.member_address = index['ADDRESS'];
              })
            },
            error: function(exception) {
                console.log(exception);
                alert("發生錯誤: " + exception.status);
            },
          })
        }
      })

    </script>
  </body>
</html>
