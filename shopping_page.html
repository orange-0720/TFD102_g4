<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>良耕野菜-商品一覽</title>
    <link rel="icon" href="./images/logo-02.svg" />
    <link rel="stylesheet" href="./css/style.css" />
    <script src="./js/jquery-3.6.0.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
  </head>
  <body>
    <header class="header">
      <!-- 手機板header -->
      <div class="fixed_top">
        <div class="fixed_top_logo">
          <a href="./index.html">
            <img src="./images/fixed_top_logo.svg" alt="top_logo">
          </a>
        </div>
        <div class="shop_car">
          <img src="./images/shopping_cart.svg" alt="shopping_cart" />
        </div>
        <div class="ham">
          <div class="ham_top"></div>
          <div class="ham_middle"></div>
          <div class="ham_bottom"></div>
        </div>
      </div>
      <!-- 手機板header結束 -->      
      <div class="menu_fixed">
        <div class="icon">
          <div class="ham">
            <div class="ham_top"></div>
            <div class="ham_middle"></div>
            <div class="ham_bottom"></div>
          </div>
          <div class="login">
            <a href="./login.html">
              <img src="./images/login_icon.svg" alt="login_icon" />
            </a>
          </div>
          <div class="shop_car">
            <img src="./images/shopping_cart.svg" alt="shopping_cart" />
          </div>
        </div>
      </div>
      <div class="menu">
        <div class="logo_img">
          <a href="./index.html">
            <img src="./images/logo.svg" alt="logo" />
          </a>
        </div>
        <div class="page_list">
          <a href="./event.html">農村體驗</a>
          <a href="./fruit_box.html">客製蔬果箱</a>
          <a href="./game.html">蔬果知識小遊戲</a>
          <a href="./aboutUs.html">關於我們</a>
          <a href="./q_a.html">問與答</a>
          <a class="on_page" href="./shopping_page.html">新鮮蔬果</a>
        </div>
      </div>
      <div class="title">
        <div class="title_btn">
          <button class="comm_us">
            聯絡我們 <img src="./images/cotact_us.svg" width="25px" alt="" />
          </button>
          <a class="buy_now" href="./shopping_page.html">
            立即買<img src="./images/buy_now.svg" width="25px" alt="" />
          </a>
        </div>
        <div class="title_pic">
          <img
            src="./images/shopping_page/shopping_page01.jpg"
            alt="checkout_pic"
            style="padding-bottom: 100px"
          />
          <span class="bkc_black"></span>
          <h1>商品一覽</h1>
        </div>
      </div>

      <!-- 漢堡彈窗 -->
      <div class="jump_hamburger_block">
        <div class="hamburger_logo">
          <a href="./index.html">
            <img src="./images/logo.svg" alt="logo">
          </a>
        </div>
        <div class="header_nav_block">
          <div class="nav_block_contact">
            <img src="./images/nav_block_pen.svg" >
            聯絡我們
          </div>
          <a class="nav_block_log" href="./login.html">
            <img src="./images/nav_block_log.svg">
            登入註冊
          </a>          
          <div class="nav_right_block">
            <div class="nav_active">
              <a href="./event.html">農村體驗</a>
              <a href="./event_info.html">預約去</a>
            </div>
            <div class="nav_buy_now">
              <a href="./shopping_page.html">立即買</a>
              <a href="./fruit_box.html">客製蔬果箱</a>
              <a href="./shopping_page.html">新鮮蔬果</a>
            </div>
            <div class="nav_knowledge">
              <a href="./game.html">蔬果知識小遊戲</a>
            </div>
          </div>
          <div class="nav_left_block">
            <div class="nav_about_us">
              <a href="./aboutUs.html">關於我們</a>
              <a href="./aboutUs.html">農場介紹</a>
              <a href="./product_introduction.html">生產介紹</a>
            </div>
            <div class="nav_QA">
              <a href="./q_a.html">問與答</a>
            </div>
          </div>
          <img src="./images/header_vegetable.svg" alt="vegetable" class="header_vegetable">
          <img src="./images/header_lemon.svg" alt="vegetable" class="header_lemon">
          <img src="./images/header_kiwi.svg" alt="vegetable" class="header_kiwi">
        </div>
      </div>
      <!-- 漢堡彈窗結束 -->

      <!-- 聯絡我們彈窗 -->
      <div class="index_contact_box">
        <div class="black_block"></div>
        <div class="cotanct_block">
          <div class="contact_block_head">
            <button class="contact_block_Xmark"></button>
          </div>
          <h2>聯絡我們</h2>
          <div class="contact_search_bar">
            <input type="text" id="order_search" placeholder="請輸入訂單編號" />
            <button class="search_icon">
              <img src="./images/header_search_icon.svg" alt="search" />
            </button>
          </div>
          <h3>若有其他問題可以點擊下方按鈕寄信</h3>
          <div class="mailto_block">
            <a class="contact_mailto" href="mailto:goodvegetablebox@gmail.com"
              >寄送問題</a
            >
          </div>
        </div>
      </div>
      <!-- 聯絡我們彈窗結束 -->

       <!-- 購物車彈窗  -->
       <div class="header_shopping_cart">
        <button class="cart_close">
          <img src="./images/checkout/X_mark.svg">
        </button>
        <div class="incart_car_block">
          <img src="./images/header_incart.svg" alt="">
        </div>
        <div class="cart_buy_list">
          <span class="cart_nothing">目前購物車空無一物</span>
        </div>
        <div class="incart_total">
          總和
          <span class="cart_total_price">0</span>元
        </div>
        <div class="incart_checkout_block">
          <a class="incart_checkout_btn" href="./checkout.html">結帳去</a>
        </div>
      </div>
      <!-- 購物車彈窗結束  -->
    </header>

    <!-- 當頁內容開始 -->
    <div id="shopping_page">
      <div class="shopping_main_block">
        <!-- 側邊欄開始 -->
        <img class="shopping_aside_pic" src="./images/shopping_page/shopping_side.svg" alt="aside">
        <div class="shopping_nav_block">
          <h2 class="show_out_block">商品一覽</h2>
          <hr />
          <div class="show_box_block">
            <div class="shopping_box_block">
              <h3 class="shopping_box_slide">
                蔬果箱
                <img class="shopping_aside_arrow" src="./images/shopping_page/shopping_arrow_icon.svg" alt="" />
              </h3>
              <div class="shopping_box_link">
                <a href="#" v-for="box in boxs">{{box}}</a>
              </div>
            </div>
            <div class="shopping_veg_block">
              <h3 class="shopping_veg_slide">
                蔬菜
                <img class="shopping_aside_arrow" src="./images/shopping_page/shopping_arrow_icon.svg" alt="" />
              </h3>
              <div class="shopping_veg_link">
                <a href="#" v-for="veg in vegs">{{veg}}</a>
              </div>
            </div>
            <div class="shopping_fruit_block">
              <h3 class="shopping_fruit_slide">
                水果
                <img 
                  class="shopping_aside_arrow"
                  src="./images/shopping_page/shopping_arrow_icon.svg"
                  />
              </h3>
              <div class="shopping_fruit_link">
                <a href="#" v-for="fruit in fruits">{{fruit}}</a>
              </div>
            </div>
            <div class="shopping_customer_block">
              <h3>
                <a href="./fruit_box.html">客製蔬果箱</a>
              </h3>
            </div>
          </div>
        </div>
        <!-- 側邊欄結束 -->

        <div class="shopping_page_list">

          <!-- 資料庫撈出資料迴圈秀出 -->
          <div class="shopping_product_block" v-for='(item,index) in page_products'>
            <a href="./itemtest.html">
              <div class="shopping_product_pic">
                <img
                  :src="item.PRODUCT_IMG"
                  :alt="item.ID"
                />
                <span @click.prevent="incart(index)" class="shopping_product_incart"></span>
              </div>
              <h4 class="shopping_product_name">{{item.PRODUCT_NAME}}</h4>
              <h5 class="shopping_product_intro">
                {{item.PRODUCT_INFO}}
              </h5>
              <h4 class="shopping_product_price">{{item.PRODUCT_PRICE}}元</h4>
            </a>
          </div>
      
          <!-- 換頁 -->
          <div class="shooping_change_page">
            <div class="change_page_block">
              <div class="circle_base_prev"></div>
              <div class="page_prev" @click="prevPage">
                <img
                  src="./images/shopping_page/shopping_prev_arrow.svg"
                  alt="上一頁"
                />
              </div>
              <div class="shopping_page_01" @click="move_page(1)">
                1
              </div>
              <div class="shopping_page_02" @click="move_page(2)">
                2
              </div>
              <div class="shopping_page_03" @click="move_page(3)">
                3
              </div>
              <div class="shopping_page_04" @click="move_page(4)">
                4
              </div>
              <div class="page_next" @click="nextPage">
                <img
                  src="./images/shopping_page/shopping_prev_arrow.svg"
                  alt="下一頁"
                />
              </div>
              <div class="circle_base_next"></div>
            </div>
          </div>
        </div>
      </div>
    </div>


    <!-- 當頁內容結束 -->
    <footer class="footer_bg">
      <img class="shopping_footer_img" src="./images/checkout/checkout_footer.svg" alt="for_footer">
      <div class="footer">
        <button class="go_top" id="go_top">
          <img src="./images/top.svg" alt="top" />
        </button>
        <div class="footer_logo">
          <a href="./index.html">
            <img src="./images/logo.svg" alt="logo" />
          </a>
        </div>
        <div class="footer_center">
          <h4>電話:02-26938800</h4>
          <h5>營業時間: 星期二至星期日(10:00 - 17:00)</h5>
          <h5>※農曆過年假期本農場也公休 網路接單為24小時</h5>
          <h5>※當日訂單最晚收到17:00</h5>
          <h5>(17:00後下單視為隔日下單)</h5>
          <div class="btn_pos">
            <button class="mail_btn">
              <img src="./images/mail.svg" alt="mail">MAIL
            </button>
          </div>
          <div class="footer_icon">
            <img src="./images/icon-fb.svg" alt="fb" />
            <img src="./images/icon-line.svg" alt="line" />
            <img src="./images/icon-ig.svg" alt="ig" />
          </div>
        </div>
        <div class="footer_right">
          <div class="right_main">
            <a href="./index.html">首頁</a>
            <a href="./event.html">農村體驗</a>
            <a href="./game.html">蔬果知識小遊戲</a>
            <a href="./aboutUs.html">關於我們</a>
            <a href="./q_a.html">問與答</a>
          </div>
          <div class="right_buy">
            <a href="./fruit_box.html">客製蔬果箱</a>
            <a href="./shopping_page.html">蔬菜</a>
            <a href="./shopping_page.html">水果</a>
          </div>
        </div>
      </div>
    </footer>

    <script src="./js/header.js"></script>
    <script>

      var shopping_page = new Vue({
        el: "#shopping_page",
        data:{
          page: 1,
          limit: 9,
          boxs:[
            '防疫蔬果箱',
            '活力蔬果箱',
            '防果箱',
          ],
          vegs:[
          '高麗菜',
          '地瓜',
          '大番茄',
          '小白菜',
          '玉米',
          '紅蘿蔔',
          '白蘿蔔',
          '萵苣',
          '青椒',
          '甜椒',
          '青江菜',
          '地瓜葉',
          'A菜',
          '玉米筍',
          '南瓜',
          '小黃瓜',
          '洋蔥',
          ],
          fruits:[
            '草莓',
            '小番茄',
            '甜橙',
            '芒果',
            '香蕉',
            '番石榴',
            '檸檬',
            '鳳梨',
            '柿子',
            '哈密瓜',
            '香瓜',
            '木瓜',
          ],
          products:[],
          totalPrice:0,
        },
        methods: {
          // 購物車功能
          incart(index){
            console.log(this.products[index]);
            console.log(this.products[index].PRODUCT_NAME);
            product_name = this.products[index].PRODUCT_NAME;
            product_price = parseInt(this.products[index].PRODUCT_PRICE);
            product_img = this.products[index].PRODUCT_IMG;
            product_value = 1;
            let item_id = Date.now();
            alert('已加入購物車')
            $('.cart_nothing').fadeOut();
            $('.cart_buy_list').append(
              `
                <div class="cart_inside_item" data-id="${item_id}">
                  <div class="cart_item_img">
                    <img src="${product_img}"/>  
                  </div>
                  <div class="cart_item_name">${product_name}</div>
                  <div class="cart_item_number">
                    <button>-</button>
                    <input type="text" value="${product_value}"/ disabled>
                    <button>+</button>
                  </div>
                  <div class="cart_item_price">${product_price}</div>
                  <div class="cart_item_delete">
                    <img src="./images/checkout/delete_icon.svg"/>  
                  </div>
                </div>
              `
            );
            this.totalPrice += product_price;
            // $('.cart_total_price').html('');
            $('.cart_total_price').html(shopping_page.totalPrice);

            let cart_item = {
                item_id: item_id,
                item_img: product_img,
                item_name: product_name,
                item_number: product_value,
                item_price: product_price,
            };
            let cart_items = JSON.parse(localStorage.getItem("cart_items"));
            if (cart_items) {
                // 若存在
                console.log('已存在')
                cart_items.unshift(cart_item);
            } else {
                // 若不存在
                console.log('不存在')
                cart_items = [cart_item];
            }
            localStorage.setItem("cart_items", JSON.stringify(cart_items));
          },
          move_page(index){
            this.page = index;
            console.log(this.products)
          },
          prevPage(){
            if(this.page != 1){
              this.page -= 1;
            }
          },
          nextPage(){
            if(this.page != 4){
              this.page += 1;
            }
          }
        },
        mounted() {
          // $.getJSON('./js/products.json').then(res => this.products = res);
          $.ajax({
            method: 'POST',
            url: 'php/getProduct.php',
            data:{},
            dataType: 'json',
            success: function(response) {
              shopping_page.products = response  
            },
            error: function(exception) {
                alert("發生錯誤: " + exception.status);
            },
          });
          
        },
        computed: {
          page_products(){
            const last_index = this.page * (this.limit -1);
            const first_index = (this.page -1) * (this.limit -1);
            const page_product = [];
            for(let i = first_index; i < this.products.length; i++){
              if(last_index < i) break;
              page_product.push(this.products[i]);
            }
            return page_product;
          },
        },
      });


      // VUE 結束

      // 側邊攔展開
      window.addEventListener('resize',function(){
        if(window.innerWidth >= 768) {
          $('.show_box_block').css("display",'block');  
        }else{
          $('.show_box_block').css("display",'none');  
        }
      })
      
      $(".shopping_box_slide").on("click", function () {
        $(".shopping_box_link").slideToggle();
      });

      $(".shopping_veg_block").on("click", function () {
        $(".shopping_veg_link").slideToggle();
      });

      $(".shopping_fruit_block").on("click", function () {
        $(".shopping_fruit_link").slideToggle();
      });

      $('.show_out_block').on('click',function(){
        if(window.innerWidth <= 767){
          $('.show_box_block').slideToggle();
        }
      })
      
      $('.shopping_veg_slide').click(function(){
        $('.shopping_veg_slide > img').toggleClass('arrow_updown');
      })
     
      $('.shopping_box_slide').click(function(){
        $('.shopping_box_slide > img').toggleClass('arrow_updown');
      })

      $(".shopping_fruit_slide").on("click", function () {
         $('.shopping_fruit_slide > img').toggleClass('arrow_updown');
      });



      // 回頁首
      $("#go_top").on("click", function (e) {
        e.preventDefault();
        $("html, body").animate(
          {
            scrollTop: 0,
          },
          750
        );
      });

      // 購物車測試
      $('.cart_buy_list').on('click','.cart_item_delete',function(e){
        let delete_price = e.target.parentElement.previousElementSibling;
        let current_price = $('.cart_total_price').text()
        let total_price = parseInt(current_price) - parseInt(delete_price);
        console.log(current_price);
        console.log(delete_price);
        console.log(total_price);
        console.log($(e.target).parent('div'));
        if(confirm('確定刪除此商品?')){
          $(e.target).parent().parent('div').fadeOut();
          // $('.cart_total_price').text() = parseInt(current_price) - parseInt(delete_price); 

          let this_id = $(e.target).closest('div.cart_inside_item').attr("data-id");  //找出該項目的item_id
          let cart_items = JSON.parse(localStorage.getItem("cart_items"));    // 從 localStorage 取得資料
          let updated_cart_items = [];   // 準備用來放要存到 localStorage 裡的資料

          cart_items.forEach(function(cart, i){
              if(this_id != cart.item_id){
                updated_cart_items.push(cart);
              }
          });

          // 回存至 localStorage
          localStorage.setItem("cart_items", JSON.stringify(updated_cart_items));
        }

      })
    </script>
  </body>
</html>
