<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>良耕野菜</title>
    <link rel="icon" href="../images/logo-02.svg">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="icon" href="../images/logo-02.svg">
    <script src="../js/jquery-3.6.0.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://smtpjs.com/v3/smtp.js"></script>
    <script>
        //AJAX
        function ifMember(){
          $.ajax({
                method: 'POST',
                url: '../php/ifMember.php',
                data:{},
                dataType: 'text',
                success: function(response) {
                  console.log(response);
                  if(response == 'yes'){
                    $('.nav_block_log > span').text('會員中心');
                    $('.login').click(function(){
                      window.location.href = 'member.html';
                    });
                  }else{
                    $('.login').click(function(){
                      window.location.href = 'login.html';
                    });
                  }
                },
                error: function(exception) {
                    console.log(exception)
                    alert("發生錯誤: " + exception.status);
                },
          });  
        }
        //註冊
        function doInsert(){
            $.ajax({            
                method: "POST",
                url: "../php/Insert.php",
                data:{ 
                    account: $('#sign_email').val(),
                    pwd : $('#sign_pwd').val(),
                    tel : $('#sign_tel').val(),
                },            
                dataType: "text",
                success: function (response) {
                    if(response == 'done'){
                      alert('註冊成功');
                      let site_now = JSON.parse(sessionStorage.getItem('site_now'));
                      if(site_now){
                        window.location.href = site_now;
                      }else{
                        window.location.href = './index.html';  
                      }
                    }
                },
                error: function(exception) {
                    alert("發生錯誤: " + exception.status);
                }
            });
        }
        // 登入
        function Login(){
          $.ajax({
            method: 'POST',
            url: '../php/login.php',
            data:{
              account: $('#login_email').val(),
              pwd : $('#login_pwd').val(),
            },
            dataType: 'json',
            success: function(response) {
                console.log(response);
                let site_now = JSON.parse(sessionStorage.getItem('site_now'));
                if(response == 1){
                    alert('登入成功');
                    if(site_now){
                      window.location.href = site_now;
                    }else{
                      window.location.href = './member.html';  
                    }
                }else{
                    console.log(response)
                    alert('查無會員')
                }
            },
            error: function(exception) {
                alert("發生錯誤: " + exception.status);
            },
          })
        };
        function forget_pwd(){
          $.ajax({
            method: 'POST',
            url: '../php/forget_pwd.php',
            data:{
              account: $('#pwd_resend').val(),
            },
            dataType: 'json',
            success: function(response) {
                console.log(response);
                if(response === 'yes'){
                    Email.send({
                    Host: "smtp.gmail.com",
                    Username: "goodvegetablebox@gmail.com",
                    Password: "tfd102g4",
                    To: $('#pwd_resend').val(),
                    From: "良耕野菜<goodvegetablebox@gmail.com>",
                    Subject: "良耕野菜",
                    Body: "感謝您使用本網站，您的新密碼為11111111，請使用新密碼重新登入",
                    }).then((message) => alert('已寄出新密碼，請使用新密碼進行登入。並請至會員中心更改密碼'))
                    .then($('.pwd_block').fadeToggle());
                }else{
                    console.log(response)
                    alert('查無此信箱')
                }
            },
            error: function(exception) {
                alert("發生錯誤: " + exception.status);
            },
          })
        };
    </script>
  </head>

  </head>
  <body onload="ifMember()">
    <header class="header">
      <!-- 手機板header -->
      <div class="fixed_top"></div>
      <!-- 手機板header結束 -->
      <!-- 桌機板header -->
      <div class="menu_fixed"></div>
      <div class="menu">
        <div class="logo_img">
          <a href="./index.html">
            <img src="../images/logo.svg" alt="logo" />
          </a>
        </div>
        <div class="page_list">
          <a href="./event.html">農村體驗</a>
          <a href="./fruit_box.html">客製蔬果箱</a>
          <a href="./game.html">蔬果知識小遊戲</a>
          <a href="./aboutUs.html">關於我們</a>
          <a href="./q_a.html">問與答</a>
          <a href="./shopping_page.html">新鮮蔬果</a>
        </div>
      </div>
      <div class="title">
        <div class="title_btn">
          <button class="comm_us">
            聯絡我們 <img src="../images/cotact_us.svg" width="25px" alt="" />
          </button>
          <a class="buy_now" href="./shopping_page.html">
            立即買<img src="../images/buy_now.svg" width="25px" alt="" />
          </a>
        </div>
      </div>
      <!-- 桌機板header 結束 -->

      <!-- 漢堡彈窗 -->
      <div class="jump_hamburger_block"></div>
      <!-- 漢堡彈窗結束 -->

      <!-- 聯絡我們彈窗 -->
      <div class="index_contact_box"></div>
       <!-- 聯絡我們彈窗結束 -->

       <!-- 購物車彈窗  -->
      <div class="cart_bk"></div>
      <div class="header_shopping_cart"></div>
      <!-- 購物車彈窗結束  -->

      <!-- 滾輪  -->
      <div class="scrollbar" id="style-6">
        <div class="force-overflow"></div>
      </div>
    </header>


    <div class="login_block">
      <div class="form_block">
        <form class="login_form" action="#" method="POST">
          <h3>會員登入</h3>
          <input type="text" placeholder="註冊信箱" id="login_email"/>
          <div id="email_fail" style="display:none"><img src="../images/login&out/error-02.svg"><h5>信箱不能為空<h5></div>

          <input type="password" placeholder="會員密碼" id="login_pwd" autocomplete="current_password" />
          <div id="pwd_fail" style="display:none"><img src="../images/login&out/error-02.svg"><h5>請輸入密碼</h5></div>

          <input type="button" value="登入" id="login_btn" />
          <!-- <a href="./member.html" id="login_btn">登入</a> -->
          <div class="login_notice">
            <a id="signup_btn">立即註冊</a>
            <span>|</span>
            <a class="pwd_btn">忘記密碼</a>
          </div>
        </form>

        <!-- 忘記密碼 -->
        <div class="pwd_block">
          <div class="pwd_block_inside">
            <h3>請輸入註冊信箱</h3>
            <input class="pwd_resend" id="pwd_resend" type="text">
            <input class="pwd_resend_btn" type="button" value="送出"/>
            <button class="cancel_btn"><img src="../images/checkout/X_mark.svg" alt=""></button>
          </div>
        </div>
        <!-- 忘記密碼 -->

        <div class="signup_form">
          <h3>會員註冊</h3>
          <form action="">

            <input class="sign_email" type="text" placeholder="註冊信箱" id="sign_email">
          <div id="sign_email_fail" style="display:none"><img src="../images/login&out/error-02.svg"><h5>信箱格式不正確，請確認</h5></div>

          <input class="sign_pwd" type="password" placeholder="會員密碼" id="sign_pwd" autocomplete="new_password">
          <div id="sign_pwd_fail" style="display:none"><img src="../images/login&out/error-02.svg"><h5>密碼需超過八位數</h5></div>

          <input class="pwd_confirm" type="password" placeholder="密碼確認" autocomplete="new_password">
          <div id="pwd_confirm_fail" style="display:none"><img src="../images/login&out/error-02.svg"><h5>請確認密碼是否相同</h5></div>

          <input class="sign_tel" type="text" placeholder="09XX-XXX-XXX" id="sign_tel">
          <div id="sign_tel_fail" style="display:none"><img src="../images/login&out/error-02.svg"><h5>請輸入正確手機格式</h5></div>
          </form>
          <label>
            <input type="checkbox" id="sign_agree">
            我已閱讀並同意<a href="./login_terms.html" target="_blank">會員條款</a>
          </label>
          <input type="button" value="註冊" id="sign_confirm_btn">
          <div class="signin_notice">
            <a id="change_to_log">已有帳號請按此登入</a>
          </div>
        </div>
      </div>
      
      <!-- 驗證碼彈窗 -->
      <div class="sign_block">
        <div class="sign_block_inside">
          <h3>請輸入驗證碼</h3>
          <input class="sign_confirm" type="text">
          <input class="sign_send_btn" type="submit" value="送出"/>
          <button class="sign_cancel_btn"><img src="../images/checkout/X_mark.svg" alt=""></button>
        </div>
      </div>
      <!-- 驗證碼彈窗 -->

      <div class="login_pic">
        <img id="login_img" src="../images/login&out/login_01.jpg" alt="login_pic"/>
      </div>
    </div>

    <script src="../js/right_nav_bar.js"></script>
    <script src="../js/shopping_cart.js"></script>
    <script src="../js/header.js"></script>
    <script src="../js/login.js"></script>
  </body>
</html>
